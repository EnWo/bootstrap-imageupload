/**
 * bootstrap-imageupload v1.2.0
 * https://github.com/egonolieux/bootstrap-imageupload
 * Copyright 2016 Egon Olieux
 * Released under the MIT license
 */

if("undefined"==typeof jQuery)throw new Error("bootstrap-imageupload's JavaScript requires jQuery.");!function(e){"use strict";function i(i){h=e.extend({},e.fn.imageupload.defaultOptions,i);var n=this,t=n.find(".file-tab"),l=n.find(".panel-heading .btn:eq(0)"),o=t.find('input[type="file"]'),d=t.find(".btn:eq(1)"),r=n.find(".url-tab"),s=n.find(".panel-heading .btn:eq(1)"),v=r.find(".btn:eq(0)"),g=r.find(".btn:eq(1)");u(t),b(r),f(t),a.call(n),l.off(),o.off(),d.off(),s.off(),v.off(),g.off(),l.on("click",function(){e(this).blur(),f(t)}),o.on("change",function(){e(this).blur(),p(t)}),d.on("click",function(){e(this).blur(),u(t)}),s.on("click",function(){e(this).blur(),c(r)}),v.on("click",function(){e(this).blur(),m(r)}),g.on("click",function(){e(this).blur(),b(r)})}function n(){this.addClass("imageupload-disabled")}function a(){this.removeClass("imageupload-disabled")}function t(){var e=this;i.call(e,h)}function l(e){var i=[];return i.push('<div class="alert alert-danger alert-dismissible">'),i.push('<button type="button" class="close" data-dismiss="alert">'),i.push("<span>&times;</span>"),i.push("</button>"+e),i.push("</div>"),i.join("")}function o(e){return'<img src="'+e+'" alt="Image preview" class="thumbnail" style="max-width: '+h.maxWidth+"px; max-height: "+h.maxHeight+'px">'}function d(e){return e.substr(e.lastIndexOf(".")+1).toLowerCase()}function r(i,n){if(i.size/1024>h.maxFileSizeKb)return void n(!1,"File is too large (max "+h.maxFileSizeKb+"kB).");var a=d(i.name);e.inArray(a,h.allowedFormats)>-1?n(!0,"Image file is valid."):n(!1,"File type is not allowed.")}function s(i,n){var a=null,t=!1,l=new Image;l.onload=function(){if(!t){window.clearTimeout(a);var l=i;-1!==l.indexOf("?")&&(l=l.split("?")[0].split("#")[0]);var o=d(l);e.inArray(o,h.allowedFormats)>-1?n(!0,"Image URL is valid."):n(!1,"File type is not allowed.")}},l.onerror=function(){t||(window.clearTimeout(a),n(!1,"Image could not be found."))},l.src=i,a=window.setTimeout(function(){t=!0,l.src="???",n(!1,"Loading image timed out.")},3e3)}function f(e){var i=e.closest(".imageupload"),n=i.find(".panel-heading .btn:eq(0)");if(!n.hasClass("active")){var a=i.find(".url-tab");i.find(".panel-heading .btn:eq(1)").removeClass("active"),n.addClass("active"),a.hide(),e.show(),b(a)}}function u(e){e.find(".alert").remove(),e.find("img").remove(),e.find(".btn span").text(h.labels.browse),e.find(".btn:eq(1)").hide(),e.find("input").val("")}function p(e){var i=e.find(".btn:eq(0)"),n=e.find(".btn:eq(1)"),a=i.find("input");if(e.find(".alert").remove(),e.find("img").remove(),i.find("span").text(h.labels.browse),n.hide(),a[0].files&&a[0].files[0]){i.prop("disabled",!0);var t=a[0].files[0];r(t,function(d,r){if(d){var s=new FileReader;s.onload=function(a){e.prepend(o(a.target.result)),i.find("span").text(h.labels.change),n.css("display","inline-block")},s.onerror=function(){e.prepend(l("Error loading image file.")),a.val("")},s.readAsDataURL(t)}else e.prepend(l(r)),i.find("span").text(h.labels.browse),a.val("");i.prop("disabled",!1)})}}function c(e){var i=e.closest(".imageupload"),n=i.find(".panel-heading .btn:eq(1)");if(!n.hasClass("active")){var a=i.find(".file-tab");i.find(".panel-heading .btn:eq(0)").removeClass("active"),n.addClass("active"),a.hide(),e.show(),u(a)}}function b(e){e.find(".alert").remove(),e.find("img").remove(),e.find(".btn:eq(1)").hide(),e.find("input").val("")}function m(i){var n=i.find('input[type="text"]'),a=i.find(".btn:eq(0)"),t=i.find(".btn:eq(1)");i.find(".alert").remove(),i.find("img").remove(),t.hide();var d=n.val();if(!d)return void i.prepend(l("Please enter an image URL."));n.prop("disabled",!0),a.prop("disabled",!0),s(d,function(r,s){r?(i.find('input[type="hidden"]').val(d),e(o(d)).insertAfter(a.closest(".input-group")),t.css("display","inline-block")):i.prepend(l(s)),n.prop("disabled",!1),a.prop("disabled",!1)})}var h={},v={init:i,disable:n,enable:a,reset:t};e.fn.imageupload=function(i){var n=arguments;return this.filter("div").each(function(){if(v[i])v[i].apply(e(this),Array.prototype.slice.call(n,1));else{if("object"!=typeof i&&i)throw new Error('Method "'+i+'" is not defined for imageupload.');v.init.apply(e(this),n)}})},e.fn.imageupload.defaultOptions={allowedFormats:["jpg","jpeg","png","gif"],maxWidth:250,maxHeight:250,maxFileSizeKb:2048,labels:{browse:"Browse",change:"Change"}}}(jQuery);